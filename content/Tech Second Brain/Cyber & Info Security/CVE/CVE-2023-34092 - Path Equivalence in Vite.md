---
title: CVE-2023-34092 - Path Equivalence in Vite (Vietnamese)
tags:
  - vulnerable
  - infosec
  - developer
---
>[!info]
>The post is written by Vietnamese, and in the future, I will try to translate to english maybe by mine LOL. You can enjoy the current Vietnamese version, and Google Translate English version . This is old vulnerables, but `ViteJS` popular, your project can infect. Go check and prevent the critical problem

<h1> Vietnamese Version </h1>
# ThÃ´ng tin lá»— há»ng

>[!info]
>**Link vulnerable:** Â [Snyk](https://security.snyk.io/vuln/SNYK-JS-VITE-5664718 "https://security.snyk.io/vuln/snyk-js-vite-5664718"), [CVE - Mitre](https://www.cve.org/CVERecord?id=CVE-2023-34092 "https://www.cve.org/cverecord?id=cve-2023-34092")Â 
>
>**PoC:** [https://github.com/advisories/GHSA-353f-5xf4-qw67](https://github.com/advisories/GHSA-353f-5xf4-qw67 "https://github.com/advisories/ghsa-353f-5xf4-qw67")
>
>**PhiÃªn báº£n package gáº·p pháº£i:** **<2.9.16 >=3.0.0 <3.2.7 >=4.0.0 <4.0.5 >=4.1.0 <4.1.5 >=4.2.0 <4.2.3 >=4.3.0 <4.3.9**

## MÃ´ táº£ lá»— há»ng

>[!important]
>Lá»— há»ng nÃ y xáº£y ra trong cÃ¡c gÃ³i package vá»›i vite

>[!info]
>**Vite** - má»™t gÃ³i package dÃ¹ng trong js vÃ  lÃ _ _má»™t build tool sá»­ dá»¥ng module bundler cÃ³ tÃªn lÃ  Rollup, Ä‘Æ°á»£c tá»‘i Æ°u hÃ³a cao cho viá»‡c generating ná»™i dung tÄ©nh (css, html)_. Má»i ngÆ°á»i cÃ³ thá»ƒ check á»Ÿ Ä‘Ã¢y Ä‘á»ƒ hiá»ƒu rÃµ Vite thÃªm ,Â [ViteJS â€“ Má»™t Frontend Build Tool chá»‰ dÃ nh cho dev thÃ­ch tá»‘c Ä‘á»™](https://vntalking.com/vitejs-la-gi-mot-frontend-build-tool-toc-do.html).

- Vá»›i tÃ­nh nÄƒng cá»§a vite lÃ  `real time debug frontend`, thÃ¬ má»i ngÆ°á»i cÃ³ thá»ƒ hiá»ƒu ráº±ng lÃ  nÃ³ sáº½ reload liÃªn tá»¥c server cá»§a mÃ¬nh vá»›i hiá»‡u suáº¥t cao nÃªn nÃ³ cáº§n sáº½ pháº£i Ä‘á»c file trá»±c tiáº¿p thÃ´ng qua má»™t sá»‘ cÃ¡i thÆ° viá»‡n `window` cÃ³ sáºµn, thÃ´ng tin chi tiáº¿t: [Why ViteJS](https://vitejs.dev/guide/why.html "https://vitejs.dev/guide/why.html"). 
- Do Ä‘Ã³ cÃ³ má»™t váº¥n Ä‘á» Ä‘Æ°á»£c Ä‘áº» ra lÃ  tháº±ng nÃ y sáº½ offer cho mÃ¬nh `server.fs.deny`Â  Ä‘á»ƒ há»— trá»£ mÃ¬nh block cÃ¡c trang khÃ´ng cáº§n thiáº¿t Ä‘á»ƒ trÃ¡nh render nháº§m. Tuy váº­y á»Ÿ má»™t sá»‘ phiÃªn báº£n mÃ¬nh cÃ³ Ä‘á» cáº­p, há» cÃ³ thá»ƒ bypass Ä‘á»ƒ access trá»±c tiáº¿p Ä‘áº¿n file Ä‘Ã³ nhÆ° khÃ´ng há» cÃ³ má»™t restrict gÃ¬ Ä‘Æ°á»£c applied cáº£ --> Dáº«n tá»›i viá»‡c hacker cÃ³ thá»ƒ khai thÃ¡c source code, sensitive file lÃ  hoÃ n toÃ n cÃ³ thá»ƒ xáº£y ra .

## Poc (Proof of concept)

Ta cÃ¹ng nÃ³i vá» cÃ¡ch lá»— há»•ng nÃ y Ä‘Æ°á»£c khai thÃ¡c nhÆ° tháº¿ nÃ o

- Äá»‘i vá»›i váº¥n Ä‘á» nÃ y, viá»‡c `CVE` nÃ y chá»‰ diá»…n ra trong mÃ´i trÆ°á»ng `development` - khi nÃ y debug mode Ä‘Æ°á»£c báº­t vÃ  script vite nÃ³ cÃ³ tÃ­nh cháº¥t sáº½ Äƒn Ä‘Æ°á»£c táº¥t cáº£ file cá»§a `source root directory` má»™t cÃ¡ch **realtime.** Do Ä‘Ã³, thÃ´ng thÆ°á»ng ngÆ°á»i dÃ¹ng cÃ³ thá»ƒ Ä‘i báº±ng route `E.x: https://vite_page/.env` --> sáº½ bá»‹ `403` vÃ¬ nÃ³ Äƒn cÃ¡i restrict cá»§a `server.fs.deny`.

	![[Pasted image 20240603155814.png]]

- Tuy nhiÃªn, hacker há» cÃ³ thá»ƒ add thÃªm má»™t slash `/` --> `//`  `(Ex: https://vite_page/.env --> https://vite_page//.env)`  thÃ¬ há» sáº½ bypass Ä‘Æ°á»£c restrict vÃ  access trá»±c tiáº¿p vÃ o source code, viá»‡c lá»—i nÃ y khÃ´ng Ä‘áº¿n tá»« phÃ­a developer mÃ  do package vite há» cÃ³ má»™t sá»‘ lá»—i trong váº¥n Ä‘á» check regex syntax lÃºc ná»‘i chuá»—i. Äá»ƒ rÃµ hÆ¡n lá»—i sai má»i ngÆ°á»i cÃ³ thá»ƒ xem. Äá»c thÃªm á»Ÿ [Commit: fix: fs.deny with leading double slash](https://github.com/vitejs/vite/commit/813ddd6155c3d54801e264ba832d8347f6f66b32)

	![[Pasted image 20240603160053.png]]

# CÃ¡ch Ä‘á»ƒ phÃ²ng trÃ¡nh lá»—i

## Äá»‘i vá»›i developer

- Update cÃ¡c phiÃªn báº£n má»›i nháº¥t cho vite package cá»¥ thá»ƒ Upgrade `vite` to version **2.9.16, 3.2.7, 4.0.5, 4.1.5, 4.2.3, 4.3.9 or higher.**
- TrÆ°á»›c khi chuáº©n bá»‹ test gÃ¬ thÃ¬ má»i ngÆ°á»i nÃªn thÃªm cháº·c cháº½ cÃ¡c route nÃªn Ä‘Æ°á»£c restrict Ä‘á»‘i vá»›i `source root directory` mÃ  khÃ´ng cho tháº±ng vite nÃ³ cÃ³ thá»ƒ Ä‘á»c trá»±c tiáº¿p nhá»¯ng file vÃ  folder Ä‘Ã³ thÃ´ng qua viá»‡c sá»­ dá»¥ng `server.fs.deny` --> TrÃ¡nh lá»™ cÃ¡c thÃ´ng tin sensitive khÃ¡ nguy hiá»ƒm áº¡Â ğŸ™ŒğŸ™ŒğŸ™Œ

## Äá»‘i vá»›i deploy

- ChÃº Ã½ setup cÃ¡c retrict route cho webserver, cháº³ng háº¡n Nginx, apache2 Ä‘á»ƒ block cÃ¡c Ä‘Æ°á»ng dáº«n sensitive.
- Vite khi build nÃ³ sáº½ giÃºp build vÃ  compress táº¥t cáº£ `source code` thÃ nh file tÄ©nh nÃªn do Ä‘Ã³, khi deploy lÃªn trÃªn cloud hoáº·c on-prem server nÃ o mÃ  cÃ³ thá»ƒ truy cáº­p qua public ip, má»i ngÆ°á»i nÃªn háº¡n cháº¿:Â   
    1. Â KhÃ´ng nÃªn trá»±c tiáº¿p dÃ¹ng cÃ¢u lá»‡nh nÃ y Ä‘á»ƒ deploy `vite dev --host <your host>`Â   
    2. Thay vÃ¬ Ä‘Ã³ má»i ngÆ°á»i sá»­ dá»¥ng `vite build && vite preview --host <your host> --port <your port>` Ä‘á»ƒ nÃ³ trá»±c tiáº¿p sá»­ dá»¥ng cÃ¡c static file Ä‘Æ°á»£c Ä‘Ã³ng gÃ³i thÃ nh 1.  
    3. Khi build image cho vite, add thÃªm `.dockerignore` cho cÃ¡c sensitive file nhÆ° `.env`, `.git` Â Ä‘á»ƒ trÃ¡nh viá»‡c khi copy vÃ o trong container nÃ³ sáº½ loáº¡i bá» nhá»¯ng thÃ´ng tin nÃ y.


<h1> English Version </h1>

# Vulnerability information

>[!info]
>**Link vulnerable:** Â [Snyk](https://security.snyk.io/vuln/SNYK-JS-VITE-5664718 "https://security.snyk.io/vuln/snyk-js-vite-5664718"), [CVE - Mitre](https://www.cve.org/CVERecord?id=CVE-2023-34092 "https://www.cve.org/cverecord?id=cve-2023-34092")Â 
>
>**PoC:** [https://github.com/advisories/GHSA-353f-5xf4-qw67](https://github.com/advisories/GHSA-353f-5xf4-qw67 "https://github.com/advisories/ghsa-353f-5xf4-qw67")
>
>**Package version encountered:** **<2.9.16 >=3.0.0 <3.2.7 >=4.0.0 <4.0.5 >=4.1.0 <4.1.5 >=4.2.0 <4.2.3 >=4.3.0 <4.3.9**

## Description of the defect

>[!important]
>This vulnerability occurs in packages with vite

>[!info]
>**Vite** - a package used in js and is_ _a build tool using a bundler module called Rollup, highly optimized for generating static content (css, html)_. Everyone can check here to understand Vite better,Â [ViteJS â€“ Why is Vite so fast?](https://dev.to/takuyakikuchi/why-is-vite-so-fast-163p).

- With Vite's feature `real time debug frontend`, everyone can understand that it will continuously reload its server with high performance so it needs to read files directly through some libraries. `window` is available, detailed information: [Why ViteJS](https://vitejs.dev/guide/why.html "https://vitejs.dev/guide/why.html"). 
- Therefore, a problem is created that this guy will offer me `server.fs.deny`Â  to help me block unnecessary pages to avoid wrong rendering. However, in some versions I mentioned, they can bypass it to directly access that file as if there was no restriction applied at all --> Leading to hackers being able to exploit source code, sensitive files are It's entirely possible.

## Poc (Proof of concept)

Let's talk about how this vulnerability is exploited

- For this issue, this `CVE` only happens in the `development` environment - when debug mode is enabled and the script vite has the property of eating all files of the `source root directory` * *realtime.** Therefore, normally users can go by route `E.x: https://vite_page/.env` --> will get `403` because it eats the restrict of `server.fs.deny` .

	![[Pasted image 20240603155814.png]]


- However, hackers can add a slash `/` --> `//` `(Ex: https://vite_page/.env --> https://vite_page//.env)` then they will bypass the restriction and access the source code directly. This error does not come from the developer but because the vite package has some errors in checking regex syntax when concatenating strings. For more clarity, everyone can see the error. Read more at [Commit: fix: fs.deny with leading double slash](https://github.com/vitejs/vite/commit/813ddd6155c3d54801e264ba832d8347f6f66b32)

	![[Pasted image 20240603160053.png]]

# How to avoid vulnerables

## For developers

- Update the latest versions for specific vite packages Upgrade `vite` to version **2.9.16, 3.2.7, 4.0.5, 4.1.5, 4.2.3, 4.3.9 or higher.**
- Before preparing any test, everyone should add strict routes that should be restricted to the `source root directory` without allowing the vite to read those files and folders directly through the use of `server. fs.deny` --> Avoid revealing sensitive information which is quite dangerousÂ ğŸ™ŒğŸ™ŒğŸ™Œ

## For deploy

- Pay attention to setting up strict routes for the webserver, such as Nginx, apache2 to block sensitive paths.
- When building Vite, it will help build and compress all `source code` into static files, so when deploying to the cloud or on-prem server that can be accessed via public ip, people should limit:Â   
    1. Â This command should not be used directly to deploy `vite dev --host <your host>`Â   
    2. Instead people use `vite build && vite preview --host <your host> --port <your port>` so it directly uses the static files packaged into 1.  
    3. When building images for vite, add `.dockerignore` to sensitive files such as `.env`, `.git` Â to avoid removing this information when copied into the container.



